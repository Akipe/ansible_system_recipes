---

- name: Installation
  pacman:
    state: present
    name:
      - hplip

- name: Installation of dependencies
  pacman:
    state: present
    name:
      - cups
      - libusb
      - python-pillow
      - python-pyqt5
      - python-reportlab
      - rpcbind
      - sane
      - wget
    extra_args: --asdeps

- name: Installation of a scanner gui
  pacman:
    state: present
    name:
      - simple-scan

- name: Installation (AUR)
  become: yes
  become_user: ansible_aur
  aur:
    use: yay
    state: present
    name:
      - hplip-plugin

- name: Enable and start CUPS service
  systemd:
    name: org.cups.cupsd.service
    enabled: yes
    state: started

- name: Add role for the user
  user:
    name: "{{ user_name }}"
    groups: 
      - cups
      - lp
      - sys
    append: yes

- name: Open firewall for ipp
  ansible.posix.firewalld:
    service: ipp
    zone: home
    state: enabled
    permanent: true
    immediate: yes

- name: Open firewall for ipp-client
  ansible.posix.firewalld:
    service: ipp-client
    zone: home
    state: enabled
    permanent: true
    immediate: yes
