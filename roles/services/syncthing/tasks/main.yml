---
- name: Install Syncthing
  pacman:
    state: present
    name: syncthing

- name: Find uid of user
  command: "id -u {{ user_name }}"
  register: user_uid
  check_mode: no # Run even in check mode, otherwise the playbook fails with --check.
  changed_when: false

- name: Start and active user Syncthing service
  become: yes
  become_user: "{{ user_name }}"
  #environment:
  #  XDG_RUNTIME_DIR: "/run/user/{{ user_uid.stdout }}"
  systemd:
    name: syncthing.service
    scope: user
    state: started
    enabled: yes

- name: Install tray app
  become: yes
  become_user: ansible_aur
  aur:
    use: yay
    skip_installed: true
    name:
      - syncthingtray
