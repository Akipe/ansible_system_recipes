---

- name: Installation
  community.general.pacman:
    name: "{{ refind_app_archlinux_common }}"
    state: present

- name: Installation of dependencies
  community.general.pacman:
    state: present
    name: "{{ refind_app_archlinux_common }}"
    extra_args: --asdeps

- name: Configure rEFInd Pacman hook update
  ansible.builtin.template:
    src: pacman_hook/refind.hook.j2
    dest: /etc/pacman.d/hooks/refind.hook
    owner: root
    group: root
    mode: "u=rwx,g=rx,o=rx"

- name: Define microcode path for Intel processor
  ansible.builtin.set_fact:
    microcode_path: "intel-ucode.img"
  when: refind_load_microcode and cpu_vendor == "intel"

- name: Define microcode path for AMD processor
  ansible.builtin.set_fact:
    microcode_path: "amd-ucode.img"
  when: refind_load_microcode and cpu_vendor == "amd"

- name: Installation of Regular theme
  become: yes
  become_user: ansible_aur
  aur:
    use: yay
    state: present
    name:
      - refind-theme-regular-git
  when: refind_os_boot_type == "gui"

- name: Set dark mode for Regular theme
  ansible.builtin.template:
    src: theme_regular/theme.conf.j2
    dest: /boot/EFI/refind/refind-theme-regular/theme.conf
    owner: root
    group: root
    mode: "u=rwx,g=rx,o=x"
  when: refind_os_boot_type == "gui"
