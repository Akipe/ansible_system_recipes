---

- name: Include tasks for Archlinux
  ansible.builtin.include_tasks: archlinux/main.yml
  when: ansible_distribution == "Archlinux"

- name: Add hostname resolution
  ansible.builtin.template:
    src: etc/nsswitch.conf.j2
    dest: /etc/nsswitch.conf
    owner: root
    group: root
    mode: u+rw,g+r,o+r
  notify: Restart Avahi

- name: Start and enable Avahi
  ansible.builtin.systemd:
    name: avahi-daemon.service
    enabled: yes
    state: started

- name: Open firewall for sshd for home
  ansible.posix.firewalld:
    ansible.builtin.service: mdns
    zone: home
    state: enabled
    permanent: true
    immediate: yes

- name: Allow firewall UDP 5353 for home
  ansible.posix.firewalld:
    port: 5353/udp
    zone: home
    state: enabled
    permanent: true
    immediate: yes
