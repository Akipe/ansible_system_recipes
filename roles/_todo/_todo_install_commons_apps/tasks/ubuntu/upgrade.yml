---
- name: Upgrade with Apt
  apt:
    update_cache: yes
    upgrade: dist

- name: Autoremove and autoclean with Apt
  apt:
    autoremove: yes
    autoclean: yes

- name: Install Apt dependency for repository with HTTPS
  apt:
    name:
      - apt-transport-https
      - ca-certificates
      - curl
      - software-properties-common
    state: present

- name: Install needrestart
  apt:
    name: needrestart
    state: present

- name: Add needrestart service
  copy:
    src: systemd/needrestart.service
    dest: /etc/systemd/system/needrestart.service
    owner: root
    group: root
    mode: u+rwx,g+rx,o+rx

- name: Add needrestart service timer
  copy:
    src: systemd/needrestart.timer
    dest: /etc/systemd/system/needrestart.timer
    owner: root
    group: root
    mode: u+rwx,g+rx,o+rx

- name: Active needrestart service timer
  systemd:
    name: needrestart.timer
    state: started
    daemon_reload: yes
    enabled: yes
